<a href="/users/<%= user.username %>/edit"><button>Edit</button></a>
<h2><%= user.username %></h2>
<img src="/images/<%= user.avatar %>" alt="user.username">
<h3><%= user.jobTitle %></h3>
<h3><%= user.jobField %></h3>
<p><%= user.blurb %></p>

<ul id="user-workspace-list" class="container">
	<% workspaceItems.forEach(function(item) { %>
		<li _id="<%= item._id %>" class="row">
			<div class="col-sm-9">
				<h3><%= item._softwareId.name %></h3>
				<p><%= item.description %></p>
			</div>
			<div class="col-sm-3">

				<button _id="<%= item._id %>" class="btn btn-danger remove-workspaceItem">Remove</button>	

			</div>
		</li>
	<% }); %>
</ul>


<form method="post" autocomplete="off" action="/workspaceitems/create">
  	<div id="search-form" class="form-group">
    	<label for="software">Software Search</label>
    	<input class="form-control" type="text" name="software" id="software-search" default="Search">
    	<ul id="search-dropdown"></ul>
  	</div>

  	<div class="form-group">
	    <label for="description">Why you use it? </label>
	    <textarea class="form-control" type="text" name="description" id="software-description"></textarea> 
  	</div>
  	<input type="hidden" name="id" id="workspace-item-id" value="">
  	<input type="hidden" name="userId" id="user-id" value="<%= user._id %>">
  	<input class="btn btn-success" type="submit" value="Add">
</form>

<script>
// Start Document Ready
$(document).ready(function(){
	console.log("Sanity Check!")

	$('.remove-workspaceItem').on('click', function(event){
		event.preventDefault();
		removeWorkspaceItem(this);
	});

	$('#software-search').on('keydown',function(event){
		updateSearchBox(this);
	})

	$('#search-dropdown').on('click','.search-result', function(event){
		event.preventDefault();
		populateSearchField(this);
	})
});
// End Doctument Ready 

function removeWorkspaceItem(clickedItem){
	let workspaceItem_id = $(clickedItem).attr('_id');

	$.ajax({
		url: `/workspaceItems/${workspaceItem_id}`,
		method: 'DELETE',
		success: workspaceItemDeleteSuccess,
		error: workspaceItemDeleteError
	});
}

function workspaceItemDeleteSuccess(json){
	console.log(json);
	$(`li[_id="${json._id}"]`).remove();
}

function workspaceItemDeleteError(){
	console.log("Delete error!");
}

function updateSearchBox(formUpdated){
	$.ajax({
		url: `/software/search/${$(formUpdated).val()}`,
		method: 'GET',
		success: softwareSearchSuccess,
		error: softwareSearchError
	})
}

function softwareSearchSuccess(json){
	$('#search-dropdown').empty().addClass('active');
	json.forEach(function(result){
		let searchItem = `<li><a class='search-result' _id='${result._id}'>${result.name}</a></li>`;
		$('#search-dropdown').append(searchItem)
	})
}

function softwareSearchError(){
	console.log('Software search failed'); 
}

function populateSearchField(clickedResult){
	$('#software-search').val($(clickedResult).text());
	$('#workspace-item-id').val($(clickedResult).attr('_id'))
	$('#search-dropdown').removeClass('active');
}
</script>
